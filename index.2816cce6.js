function e(e){return e&&e.__esModule?e.default:e}class t{constructor(e){this.baseUrl_=e,this.pages_=[""],this.currentPage_=0}nextPage(){return this.currentPage_!==this.pages_.length-1&&(this.currentPage_++,!0)}prevPage(){return 0!==this.currentPage_&&(this.currentPage_--,!0)}getUrl_(){const e=this.pages_[this.currentPage_];return`${this.baseUrl_}?after=${e}`}async fetch(){const e=await fetch(this.getUrl_()),t=await e.json();return this.currentPage_===this.pages_.length-1&&this.pages_.push(t.data.after),t.data.children.map((({data:e},t)=>{const i={url:e.url,author:e.author,title:e.title,permalink:"https://reddit.com"+e.permalink,id:e.id,index:t+1};return e.is_video&&e.media.reddit_video?Object.assign(i,this.extractVideo_(e)):e.url.startsWith("https://v.redd.it/")?Object.assign(i,this.guessVideo_(e)):e.url.startsWith("https://i.redd.it/")?Object.assign(i,this.extractImage_(e)):e.url.startsWith("https://gfycat.com/")&&Object.assign(i,this.extractGfycat_(e)),i})).filter((e=>e.image||e.video||e.gfycat))}extractImage_(e){return{image:{width:e.thumbnail_width,height:e.thumbnail_height,src:e.url}}}extractGfycat_(e){const t=e.url.match(/^https:\/\/gfycat\.com\/([^\/]+)/);return t?{gfycat:{width:e.thumbnail_width,height:e.thumbnail_height,id:t[1]}}:{}}extractVideo_(e){return{video:{poster:this.getPoster_(e),src:{fallback:e.media.reddit_video.fallback_url,hls:e.media.reddit_video.hls_url,dash:e.media.reddit_video.dash_url}}}}guessVideo_(e){return{video:{poster:this.getPoster_(e),src:{fallback:`${e.url}/DASH_480?source=fallback`,hls:`${e.url}/HLSPlaylist.m3u8`,dash:`${e.url}/DASHPlaylist.mpd`}}}}getPoster_(e){if(e.preview&&e.preview.images)return e.preview.images[0].source.url.replace(/&amp;/g,"&")}}const i={"#me":{url:"https://www.reddit.com/r/me_irl.json",title:"me_irl"},"#new":{url:"https://www.reddit.com/r/me_irl/new.json",title:"me_irl"},"#meow":{url:"https://www.reddit.com/r/MEOW_IRL.json",title:"meow_irl"},"#woof":{url:"https://www.reddit.com/r/woof_irl.json",title:"woof_irl"}};var n={};n=function(){
/*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   */
var e=Object.prototype.toString,t=Array.isArray||function(t){return"[object Array]"===e.call(t)};function i(e){return"function"==typeof e}function n(e){return t(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function s(e,t){return null!=e&&"object"==typeof e&&t in e}function a(e,t){return null!=e&&"object"!=typeof e&&e.hasOwnProperty&&e.hasOwnProperty(t)}var o=RegExp.prototype.test;function c(e,t){return o.call(e,t)}var l=/\S/;function h(e){return!c(l,e)}var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function u(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return p[e]}))}var d=/\s*/,m=/\s+/,f=/\s*=/,g=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/;function v(e,i){if(!e)return[];var n,s,a,o=!1,c=[],l=[],p=[],u=!1,v=!1,k="",x=0;function P(){if(u&&!v)for(;p.length;)delete l[p.pop()];else p=[];u=!1,v=!1}function S(e){if("string"==typeof e&&(e=e.split(m,2)),!t(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(r(e[0])+"\\s*"),s=new RegExp("\\s*"+r(e[1])),a=new RegExp("\\s*"+r("}"+e[1]))}S(i||C.tags);for(var j,E,L,U,O,A,T=new b(e);!T.eos();){if(j=T.pos,L=T.scanUntil(n))for(var I=0,R=L.length;I<R;++I)h(U=L.charAt(I))?(p.push(l.length),k+=U):(v=!0,o=!0,k+=" "),l.push(["text",U,j,j+1]),j+=1,"\n"===U&&(P(),k="",x=0,o=!1);if(!T.scan(n))break;if(u=!0,E=T.scan(y)||"name",T.scan(d),"="===E?(L=T.scanUntil(f),T.scan(f),T.scanUntil(s)):"{"===E?(L=T.scanUntil(a),T.scan(g),T.scanUntil(s),E="&"):L=T.scanUntil(s),!T.scan(s))throw new Error("Unclosed tag at "+T.pos);if(O=">"==E?[E,L,j,T.pos,k,x,o]:[E,L,j,T.pos],x++,l.push(O),"#"===E||"^"===E)c.push(O);else if("/"===E){if(!(A=c.pop()))throw new Error('Unopened section "'+L+'" at '+j);if(A[1]!==L)throw new Error('Unclosed section "'+A[1]+'" at '+j)}else"name"===E||"{"===E||"&"===E?v=!0:"="===E&&S(L)}if(P(),A=c.pop())throw new Error('Unclosed section "'+A[1]+'" at '+T.pos);return _(w(l))}function w(e){for(var t,i,n=[],r=0,s=e.length;r<s;++r)(t=e[r])&&("text"===t[0]&&i&&"text"===i[0]?(i[1]+=t[1],i[3]=t[3]):(n.push(t),i=t));return n}function _(e){for(var t,i=[],n=i,r=[],s=0,a=e.length;s<a;++s)switch((t=e[s])[0]){case"#":case"^":n.push(t),r.push(t),n=t[4]=[];break;case"/":r.pop()[5]=t[2],n=r.length>0?r[r.length-1][4]:i;break;default:n.push(t)}return i}function b(e){this.string=e,this.tail=e,this.pos=0}function k(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function x(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}b.prototype.eos=function(){return""===this.tail},b.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},b.prototype.scanUntil=function(e){var t,i=this.tail.search(e);switch(i){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=t.length,t},k.prototype.push=function(e){return new k(e,this)},k.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var r,o,c,l=this,h=!1;l;){if(e.indexOf(".")>0)for(r=l.view,o=e.split("."),c=0;null!=r&&c<o.length;)c===o.length-1&&(h=s(r,o[c])||a(r,o[c])),r=r[o[c++]];else r=l.view[e],h=s(l.view,e);if(h){t=r;break}l=l.parent}n[e]=t}return i(t)&&(t=t.call(this.view)),t},x.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},x.prototype.parse=function(e,t){var i=this.templateCache,n=e+":"+(t||C.tags).join(":"),r=void 0!==i,s=r?i.get(n):void 0;return null==s&&(s=v(e,t),r&&i.set(n,s)),s},x.prototype.render=function(e,t,i,n){var r=this.getConfigTags(n),s=this.parse(e,r),a=t instanceof k?t:new k(t,void 0);return this.renderTokens(s,a,i,e,n)},x.prototype.renderTokens=function(e,t,i,n,r){for(var s,a,o,c="",l=0,h=e.length;l<h;++l)o=void 0,"#"===(a=(s=e[l])[0])?o=this.renderSection(s,t,i,n,r):"^"===a?o=this.renderInverted(s,t,i,n,r):">"===a?o=this.renderPartial(s,t,i,r):"&"===a?o=this.unescapedValue(s,t):"name"===a?o=this.escapedValue(s,t,r):"text"===a&&(o=this.rawValue(s)),void 0!==o&&(c+=o);return c},x.prototype.renderSection=function(e,n,r,s,a){var o=this,c="",l=n.lookup(e[1]);function h(e){return o.render(e,n,r,a)}if(l){if(t(l))for(var p=0,u=l.length;p<u;++p)c+=this.renderTokens(e[4],n.push(l[p]),r,s,a);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)c+=this.renderTokens(e[4],n.push(l),r,s,a);else if(i(l)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(n.view,s.slice(e[3],e[5]),h))&&(c+=l)}else c+=this.renderTokens(e[4],n,r,s,a);return c}},x.prototype.renderInverted=function(e,i,n,r,s){var a=i.lookup(e[1]);if(!a||t(a)&&0===a.length)return this.renderTokens(e[4],i,n,r,s)},x.prototype.indentPartial=function(e,t,i){for(var n=t.replace(/[^ \t]/g,""),r=e.split("\n"),s=0;s<r.length;s++)r[s].length&&(s>0||!i)&&(r[s]=n+r[s]);return r.join("\n")},x.prototype.renderPartial=function(e,t,n,r){if(n){var s=this.getConfigTags(r),a=i(n)?n(e[1]):n[e[1]];if(null!=a){var o=e[6],c=e[5],l=e[4],h=a;0==c&&l&&(h=this.indentPartial(a,l,o));var p=this.parse(h,s);return this.renderTokens(p,t,n,h,r)}}},x.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(null!=i)return i},x.prototype.escapedValue=function(e,t,i){var n=this.getConfigEscape(i)||C.escape,r=t.lookup(e[1]);if(null!=r)return"number"==typeof r&&n===C.escape?String(r):n(r)},x.prototype.rawValue=function(e){return e[1]},x.prototype.getConfigTags=function(e){return t(e)?e:e&&"object"==typeof e?e.tags:void 0},x.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!t(e)?e.escape:void 0};var C={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){P.templateCache=e},get templateCache(){return P.templateCache}},P=new x;return C.clearCache=function(){return P.clearCache()},C.parse=function(e,t){return P.parse(e,t)},C.render=function(e,t,i,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return P.render(e,t,i,r)},C.escape=u,C.Scanner=b,C.Context=k,C.Writer=x,C}();const r='<!doctype html>\n\x3c!--\n Copyright 2019 Google LLC\n\n Licensed under the Apache License, Version 2.0 (the "License");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an "AS IS" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n--\x3e\n\n<html âš¡ lang="en">\n\n<head>\n  <meta charset="utf-8">\n  <script async src="https://cdn.ampproject.org/v0.js"><\/script>\n  <script async custom-element="amp-story" src="https://cdn.ampproject.org/v0/amp-story-1.0.js"><\/script>\n  <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"><\/script>\n  <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-gfycat-0.1.js"><\/script>\n  <title>{{title}}</title>\n  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">\n  <link rel="canonical" href="{{canonical}}">\n  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n  <style amp-custom>\n    amp-img img {\n      object-fit: contain;\n    }\n  </style>\n</head>\n\n<body>\n  <amp-story standalone title="{{title}}">\n    {{#items}}\n    <amp-story-page id="page{{index}}" data-reddit-id="{{id}}">\n      <amp-story-grid-layer template="vertical">\n        {{#video}}\n        <amp-video autoplay poster="{{poster}}" layout="fill">\n          <source src={{src.dash}} type="application/dash+xml">\n          <source src={{src.hls}} type="application/vnd.apple.mpegURL">\n          <source src="{{src.fallback}}" type="video/mp4">\n        </amp-video>\n        {{/video}}\n        {{#image}}\n        <amp-img src="{{src}}" layout="fill">\n        </amp-img>\n        {{/image}}\n        {{#gfycat}}\n        <amp-gfycat data-gfyid="{{id}}" layout="responsive" width="1" height="2">\n        </amp-gfycat>\n        {{/gfycat}}\n      </amp-story-grid-layer>\n    </amp-story-page>\n    {{/items}}\n  </amp-story>\n</body>\n\n</html>\n';e(n).parse(r);class s{constructor({container:e,iframe:t,next:i,prev:n,link:r,fullscreen:s}){this.container_=e,this.iframe_=null,this.link_=r,this.isFullscreen_=!1,window.addEventListener("hashchange",this.update_),window.addEventListener("resize",this.resize_),i.addEventListener("click",this.onNextClick_),n.addEventListener("click",this.onPrevClick_),s.addEventListener("click",this.fullscreen_),this.resize_(),this.update_()}onNextClick_=e=>{e.preventDefault(),this.irl.nextPage()&&this.render_()};onPrevClick_=e=>{e.preventDefault(),this.irl.prevPage()&&this.render_()};onStoryPageChange_=e=>{const t=e.getAttribute("data-reddit-id"),{title:i,permalink:n}=this.itemMap_.get(t);this.link_.textContent=`ðŸ”— ${i}`,this.link_.setAttribute("href",n)};update_=async()=>{i[window.location.hash]||(window.location.hash="#meow"),this.target_=i[window.location.hash],this.container_.className="",await this.display_(),this.container_.className="loaded"};resize_=()=>{this.container_.style.height=window.innerHeight+"px"};fullscreen_=()=>{this.isFullscreen_?(this.isFullscreen_=!1,document.exitFullscreen()):(this.isFullscreen_=!0,document.documentElement.requestFullscreen())};async display_(){this.irl=new t(this.target_.url),await this.render_()}async render_(){const t=await this.irl.fetch(),i=e(n).render(r,{taget:this.target_.title,canonical:window.location.href,items:t});this.itemMap_=new Map(t.map((e=>[e.id,e])));const s=new Blob([i],{type:"text/html"}),a=URL.createObjectURL(s),o=this.createIframe_();o.setAttribute("src",a),this.container_.prepend(o),await new Promise((e=>o.addEventListener("load",e))),URL.revokeObjectURL(a),this.iframe_&&this.container_.removeChild(this.iframe_),this.iframe_=o,o.style.display="",this.registerPageChange_(this.onStoryPageChange_)}registerPageChange_(e){const t=this.iframe_.contentDocument.querySelector("amp-story");new MutationObserver((t=>{const i=t.map((e=>e.target)).find((e=>"AMP-STORY-PAGE"===e.tagName&&e.hasAttribute("active")));i&&e(i)})).observe(t,{subtree:!0,attributeFilter:["active"]})}createIframe_(){const e=document.createElement("iframe");return e.setAttribute("sandbox","allow-scripts allow-same-origin"),e.style.display="none",e}}async function a(){new s({container:document.querySelector("#container"),iframe:document.querySelector("#story"),next:document.querySelector("#next"),prev:document.querySelector("#prev"),link:document.querySelector("#link"),fullscreen:document.querySelector("#fullscreen")}),window.scrollTo(0,1)}"complete"===document.readyState||"interactive"===document.readyState?a():document.addEventListener("DOMContentLoaded",a);
//# sourceMappingURL=index.2816cce6.js.map
